description: >
  Publishes a cloudflare wrangler site

parameters:
  environment:
    type: string
    description: >
      The environment to publish the site under. Will be passed to wrangler as --env.
      Needs to be specified in wrangler.toml

steps:
  - when:
      condition:
        equal: [ "", << parameters.environment >> ]
      steps:
        - run:
            name: Install yarn
            command: |
              npm i -g yarn
        - run:
            name: Install wrangler
            command: |
              yarn global add @cloudflare/wrangler
        - run:
            name: Publish site
            command: |
              wrangler publish
  - unless:
      condition:
        equal: [ "", << parameters.environment >> ]
      steps:
        - run:
            name: Install yarn
            command: |
              npm i -g yarn
        - run:
            name: Install wrangler
            command: |
              yarn global add @cloudflare/wrangler
        - run:
            name: Publish Site
            command: |
              wrangler publish --env << parameters.environment >>
